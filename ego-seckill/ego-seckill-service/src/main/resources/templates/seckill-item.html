<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
	<title>易购商城--秒杀详情页</title>
	<link rel="icon" href="/assets/img/favicon.ico">
	<base target="/" href="/">

	<link rel="stylesheet" type="text/css" href="css/webbase.css" />
	<link rel="stylesheet" type="text/css" href="css/pages-zoom.css" />
	<link rel="stylesheet" type="text/css" href="css/pages-seckill-item.css" />
	<link rel="stylesheet" type="text/css" href="css/widget-cartPanelView.css" />
</head>

<body>

<!-- 头部栏位 -->
<!--页面顶部，由js动态加载-->
<script type="text/javascript" src="plugins/jquery/jquery.min.js"></script>
<div id="nav-bottom"></div>
<script type="text/javascript">$("#nav-bottom").load("top.html");</script>

<script type="text/javascript" src="js/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript">
    $(function(){
        $("#service").hover(function(){
            $(".service").show();
        },function(){
            $(".service").hide();
        });
        $("#shopcar").hover(function(){
            $("#shopcarlist").show();
        },function(){
            $("#shopcarlist").hide();
        });

    })
</script>
<script type="text/javascript" src="js/widget/cartPanelView.js"></script>
<script type="text/javascript" src="js/model/cartModel.js"></script>
<script type="text/javascript" src="js/czFunction.js"></script>
<script type="text/javascript" src="js/plugins/jquery.easing/jquery.easing.min.js"></script>
<script type="text/javascript" src="js/plugins/sui/sui.min.js"></script>
<script type="text/javascript" src="js/plugins/jquery.jqzoom/jquery.jqzoom.js"></script>
<script type="text/javascript" src="js/plugins/jquery.jqzoom/zoom.js"></script>
<script type="text/javascript">
    $(function(){
        $("ul.btn-choose li a.btn-xlarge").click(function(){
            alert("钻中");
        });
        $("#star").click(function(){
            alert("关注成功");
        })
    })
</script>
</body>
<div class="py-container" id="app">
	<div id="item">
		<div class="crumb-wrap">
			<ul class="sui-breadcrumb">

			</ul>
		</div>
		<!--product-info-->
		<div class="product-info">
			<div class="fl preview-wrap">
				<!--放大镜效果-->
				<div class="zoom">
					<!--默认第一个预览-->
					<div id="preview" class="spec-preview">
						<span class="jqzoom"><img jqimg="img/_/b1.png" src="img/_/s1.png" /></span>
					</div>
				</div>

			</div>
			<div class="fr itemInfo-wrap">
				<div class="sku-name">
					<h4>{{seckillGoods.title}}</h4>
				</div>
				<div class="news">
					<span><img src="img/_/clock.png"/>品味秒杀</span>
					<span class="overtime" >

						<count-down :current-time="currentTime" :start-time="startTime" :end-time="endTime" v-on:start_callback="countDownS_cb(1)" v-on:end_callback="countDownE_cb(1)"></count-down></span>
						<!--<count-down :current-time="currentTime" :start-time="currentTime" :end-time="startTime" :tip-text-end="'距离开始:'"  v-on:start_callback="countDownS_cb(2)" v-on:end_callback="countDownE_cb(2)"></count-down>-->
					<!--<span class="overtime" v-else><count-down :current-time="currentTime" :start-time="currentTime" :end-time="endTime" :tip-text="'距离开始'" :tip-text-end="'距离结束:'" :end-text="'结束啦～'" v-on:start_callback="countDownS_cb(2)" v-on:end_callback="countDownE_cb(2)"></count-down></span>-->
					<!--<span class="overtime"><count-down :current-time="1556158209093" :start-time="1556094390000" :end-time="1556270793000" :tip-text="'自定义开始文字'" :tip-text-end="'自定义结束文字'" :end-text="'结束啦～'" v-on:start_callback="countDownS_cb(2)" v-on:end_callback="countDownE_cb(2)"></count-down></span>-->

				</div>
				<div class="summary">
					<div class="summary-wrap">

						<div class="fl title">
							<i>秒杀价</i>
						</div>
						<div class="fl price">
							<i>¥</i>
							<em>{{ego.formatPrice(seckillGoods.seckillPrice)}}</em>
							<span>原价：{{ego.formatPrice(seckillGoods.price)}}</span>
						</div>
						<div class="fr remark">

						</div>
					</div>
					<div class="summary-wrap">
						<div class="fl title">
							<i>促　　销</i>
						</div>
						<div class="fl fix-width">
							<i class="red-bg">加价购</i>
							<em class="t-gray">满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</em>
						</div>
					</div>
				</div>
				<div class="support">
					<div class="summary-wrap">
						<div class="fl title">
							<i>支　　持</i>
						</div>
						<div class="fl fix-width">
							<em class="t-gray">以旧换新，闲置手机回收  4G套餐超值抢  礼品购</em>
						</div>
					</div>
					<div class="summary-wrap">
						<div class="fl title">
							<i>配 送 至</i>
						</div>
						<div class="fl fix-width">
							<em class="t-gray">满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</em>
						</div>
					</div>
				</div>
				<div class="clearfix choose">


					<div class="summary-wrap">
						<div class="fl title">

						</div>
						<div class="fl">
							<ul class="btn-choose unstyled">
								<li>
									<a :disabled="!url"  class="sui-btn  btn-danger addshopcar" @click="seckill">立即抢购</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--product-detail-->
		<div class="clearfix product-detail">
			<div class="fl aside">
				<div class="shop">
					<span class="fl">三星旗舰店</span><span class="fr"><a href="shop.html" target="_blank" class="sui-btn btn-bordered btn-danger">进入店铺</a></span>
				</div>
				<div class="clearfix"></div>
				<ul class="sui-nav nav-tabs tab-wraped">
					<li class="active">
						<a href="#index" data-toggle="tab">
							<span>相关分类</span>
						</a>
					</li>
					<li>
						<a href="#profile" data-toggle="tab">
							<span>推荐品牌</span>
						</a>
					</li>
				</ul>
				<div class="tab-content tab-wraped">
					<div id="index" class="tab-pane active">
						<ul class="part-list unstyled">
							<li>手机</li>
							<li>手机壳</li>
							<li>内存卡</li>
							<li>Iphone配件</li>
							<li>贴膜</li>
							<li>手机耳机</li>
							<li>移动电源</li>
							<li>平板电脑</li>
						</ul>
						<ul class="goods-list unstyled">
							<li>
								<div class="list-wrap">
									<div class="p-img">
										<img src="img/_/part01.png" />
									</div>
									<div class="attr">
										<em>Apple苹果iPhone 6s (A1699)</em>
									</div>
									<div class="price">
										<strong>
											<em>¥</em>
											<i>6088.00</i>
										</strong>
									</div>
									<div class="operate">
										<a href="javascript:void(0);" class="sui-btn btn-bordered">加入购物车</a>
									</div>
								</div>
							</li>
							<li>
								<div class="list-wrap">
									<div class="p-img">
										<img src="img/_/part02.png" />
									</div>
									<div class="attr">
										<em>Apple苹果iPhone 6s (A1699)</em>
									</div>
									<div class="price">
										<strong>
											<em>¥</em>
											<i>6088.00</i>
										</strong>
									</div>
									<div class="operate">
										<a href="javascript:void(0);" class="sui-btn btn-bordered">加入购物车</a>
									</div>
								</div>
							</li>
							<li>
								<div class="list-wrap">
									<div class="p-img">
										<img src="img/_/part03.png" />
									</div>
									<div class="attr">
										<em>Apple苹果iPhone 6s (A1699)</em>
									</div>
									<div class="price">
										<strong>
											<em>¥</em>
											<i>6088.00</i>
										</strong>
									</div>
									<div class="operate">
										<a href="javascript:void(0);" class="sui-btn btn-bordered">加入购物车</a>
									</div>
								</div>
								<div class="list-wrap">
									<div class="p-img">
										<img src="img/_/part02.png" />
									</div>
									<div class="attr">
										<em>Apple苹果iPhone 6s (A1699)</em>
									</div>
									<div class="price">
										<strong>
											<em>¥</em>
											<i>6088.00</i>
										</strong>
									</div>
									<div class="operate">
										<a href="javascript:void(0);" class="sui-btn btn-bordered">加入购物车</a>
									</div>
								</div>
								<div class="list-wrap">
									<div class="p-img">
										<img src="img/_/part03.png" />
									</div>
									<div class="attr">
										<em>Apple苹果iPhone 6s (A1699)</em>
									</div>
									<div class="price">
										<strong>
											<em>¥</em>
											<i>6088.00</i>
										</strong>
									</div>
									<div class="operate">
										<a href="javascript:void(0);" class="sui-btn btn-bordered">加入购物车</a>
									</div>
								</div>
							</li>
						</ul>
					</div>
					<div id="profile" class="tab-pane">
						<p>推荐品牌</p>
					</div>
				</div>
			</div>
			<div class="fr detail">

				<div class="tab-main intro">
					<ul class="sui-nav nav-tabs tab-wraped">
						<li class="active">
							<a href="#one" data-toggle="tab">
								<span>商品介绍</span>
							</a>
						</li>
						<li>
							<a href="#two" data-toggle="tab">
								<span>规格与包装</span>
							</a>
						</li>
						<li>
							<a href="#three" data-toggle="tab">
								<span>售后保障</span>
							</a>
						</li>
						<li>
							<a href="#four" data-toggle="tab">
								<span>商品评价</span>
							</a>
						</li>
						<li>
							<a href="#five" data-toggle="tab">
								<span>手机社区</span>
							</a>
						</li>
					</ul>
					<div class="clearfix"></div>
					<div class="tab-content tab-wraped">
						<div id="one" class="tab-pane active">
							<ul class="goods-intro unstyled">
								<li>分辨率：1920*1080(FHD)</li>
								<li>后置摄像头：1200万像素</li>
								<li>前置摄像头：500万像素</li>
								<li>核 数：其他</li>
								<li>频 率：以官网信息为准</li>
								<li>品牌： Apple</li>
								<li>商品名称：APPLEiPhone 6s Plus</li>
								<li>商品编号：1861098</li>
								<li>商品毛重：0.51kg</li>
								<li>商品产地：中国大陆</li>
								<li>热点：指纹识别，Apple Pay，金属机身，拍照神器</li>
								<li>系统：苹果（IOS）</li>
								<li>像素：1000-1600万</li>
								<li>机身内存：64GB</li>
							</ul>
							<div class="intro-detail">
								<img src="img/_/intro01.png" />
								<img src="img/_/intro02.png" />
								<img src="img/_/intro03.png" />
							</div>
						</div>
						<div id="two" class="tab-pane">
							<p>规格与包装</p>
						</div>
						<div id="three" class="tab-pane">
							<p>售后保障</p>
						</div>
						<div id="four" class="tab-pane">
							<p>商品评价</p>
						</div>
						<div id="five" class="tab-pane">
							<p>手机社区</p>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</div>


<!-- 底部栏位 -->
<!--页面底部，由js动态加载-->
<div class="clearfix footer"></div>
<script type="text/javascript">$(".footer").load("foot.html");</script>
<!--页面底部END-->



<!--侧栏面板开始,由js动态加载-->
<script type="text/javascript" src="plugins/jquery/jquery.min.js"></script>
<div class="J-global-toolbar"></div>
<script type="text/javascript">$(".J-global-toolbar").load("side.html");</script>

<!--购物车单元格 模板-->
<script type="text/template" id="tbar-cart-item-template">
	<div class="tbar-cart-item" >
		<div class="jtc-item-promo">
			<em class="promo-tag promo-mz">满赠<i class="arrow"></i></em>
			<div class="promo-text">已购满600元，您可领赠品</div>
		</div>
		<div class="jtc-item-goods">
			<span class="p-img"><a href="#" target="_blank"><img src="{2}" alt="{1}" height="50" width="50" /></a></span>
			<div class="p-name">
				<a href="#">{1}</a>
			</div>
			<div class="p-price"><strong>¥{3}</strong>×{4} </div>
			<a href="#none" class="p-del J-del">删除</a>
		</div>
	</div>
</script>
<!--侧栏面板结束-->
<script src="./js/vue/vue.js"></script>
<script src="./js/axios.min.js"></script>
<script src="./js/common.js"></script>
<script src="./js/vue2-countdown.js"></script>
<script th:inline="javascript">
    const seckillGoods = /*[[${seckillGoods}]]*/ {};

</script>
<script type="text/javascript">
    var vm = new Vue({
        el:"#app",
        data:{
            ego,
            seckillGoods:seckillGoods,
            currentTime:new Date(seckillGoods.currentTime).getTime(),
            startTime:new Date(seckillGoods.startTime).getTime(),
            endTime:new Date(seckillGoods.endTime).getTime(),
            url: ""
        },
		created(){
			//活动是否开始?
				//没有开始-->起始时间为数据库起始时间
			if(this.currentTime > this.startTime)
			{
				//已经开始-->起始时间为当前时间
				this.startTime = this.currentTime;
			}

			// 判断登录状态
			ego.http.get("/auth/verify").then(() => {

			    //判断是否可以抢购
                if (this.currentTime > this.startTime && this.currentTime <= this.startTime) {
                    ego.http.get("/seckill/get_path/"+seckillGoods.id).then(({data})=>{
                        this.url = data;
                    });
                }

			}).catch(() => {
				// 未登录，跳转至登录页
				location.href = "/login.html?returnUrl=" + location.href;
			})
		},
        methods:{

            countDownS_cb:function(a){
                ego.http.get("/seckill/get_path/"+seckillGoods.id+"/"+seckillGoods.skuId).then(({data})=>{
                    this.url = data;
                });
                console.log('callBack--'+a+'--开始倒计时结束回调');
            },
            countDownE_cb:function(a){
                this.url = "";
                console.log('callBack--'+a+'--活动剩余倒计时结束回调');
            },
			seckill(){
                // 判断登录状态
                ego.http.get("/auth/verify").then(() => {
                    ego.http.post("/seckill/"+this.url+"/seck",this.seckillGoods).then(({data})=>{
                        alert("请等待抢购结果...");
                        //this.url = "";
                        //开启定时任务，查询付款状态
                        const taskId = setInterval(() => {
                            ego.http.get("/seckill/checkSeckillOrder/" + data).then(resp => {
                                let orderId = resp.data;
                                if (orderId){
                                    // 抢购成功
                                    clearInterval(taskId);
                                    // 在线支付，需要到付款页
                                    window.location = "pay.html?orderId=" + orderId;
                                }
                            }).catch(resp=>{
                                // 抢购失败
                                alert("抢购失败");
                                clearInterval(taskId);
                                // 跳转到付款失败页
                                // location.href = "/payfail.html"

                            })
                        },5000);
                    }).catch(resp=>{
                        this.url = "";
                        alert("抢购失败");
                        // location.href = "/payfail.html"
					})
                }).catch(() => {
                    // 未登录，跳转至登录页
                    location.href = "/login.html?returnUrl=" + location.href;
                })
			}
        },
        components: {
            shortcut: () => import("./js/pages/shortcut.js"),
            'count-down': countdown,
            'readme':readme
        }
    });
</script>

</html>
